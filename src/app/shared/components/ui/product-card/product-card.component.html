<!-- src/app/shared/components/ui/product-card/product-card.component.html -->
<div 
  (click)="onProductClick()"
  class="bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer group overflow-hidden flex flex-col h-full">
  
  <!-- Imagen del producto -->
  <div #imageContainer class="relative aspect-square overflow-hidden">
    
    <!-- Placeholder/Skeleton mientras carga -->
    @if (!isImageInView() || (!isImageLoaded() && !hasImageError())) {
      <div class="w-full h-full bg-gray-200 animate-pulse flex items-center justify-center">
        <div class="w-12 h-12 bg-gray-300 rounded-full"></div>
      </div>
    }
    
    <!-- Imagen real con lazy loading -->
    @if (isImageInView() && !hasImageError()) {
      <img 
        [src]="imageSrc()" 
        [alt]="product.name"
        (load)="onImageLoad()"
        (error)="onImageError()"
        [class]="'w-full h-full object-cover group-hover:scale-105 transition-transform duration-300' + (isImageLoaded() ? ' opacity-100' : ' opacity-0')"
        loading="lazy">
    }
    
    <!-- Imagen de error/fallback -->
    @if (hasImageError()) {
      <div class="w-full h-full bg-gray-100 flex items-center justify-center">
        <div class="text-center text-gray-400">
          <div class="text-4xl mb-2">ðŸ“·</div>
          <div class="text-sm">Error al cargar</div>
        </div>
      </div>
    }
    
    <!-- Badge de tendencia -->
    @if (product.isTrend) {
      <div class="absolute top-3 left-3">
        <span class="bg-pink-500 text-white text-xs font-medium px-2 py-1 rounded-full">
          Tendencia
        </span>
      </div>
    }
    
    <!-- Badge de agotado -->
    @if (product.status === 'sold-out') {
      <div class="absolute top-3 right-3">
        <span class="bg-black text-white text-xs font-medium px-2 py-1 rounded-full">
          Agotado
        </span>
      </div>
    }
    
    <!-- Overlay de hover sutil -->
    <div class="absolute inset-0 bg-black opacity-0 group-hover:opacity-5 transition-opacity duration-300 pointer-events-none"></div>
  </div>
  
  <!-- Contenido de la card -->
  <div class="p-4 flex flex-col flex-grow">
    
    <!-- Rating -->
    <div class="flex items-center space-x-1 mb-2">
      <div class="flex text-yellow-400">
        @for (star of [1,2,3,4,5]; track star) {
          <lucide-angular [img]="Star" class="w-4 h-4" [class.fill-current]="star <= product.rating" [class.text-gray-300]="star > product.rating" />
        }
      </div>
      <span class="text-sm text-gray-600">{{ product.rating }}</span>
    </div>
    
    <!-- Nombre del producto -->
    <h3 class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2 group-hover:text-pink-600 transition-colors duration-200 flex-grow">
      {{ product.name }}
    </h3>
    
    <!-- Precio -->
    <div class="mb-3">
      @if (product.originalPrice && product.originalPrice > product.price) {
        <div class="flex items-center space-x-2 flex-wrap">
          <span class="text-xl font-bold text-pink-600">
            ${{ product.price.toLocaleString() }}.00 COP
          </span>
          <span class="text-sm text-gray-500 line-through">
            ${{ product.originalPrice.toLocaleString() }}.00 COP
          </span>
          <span class="text-xs bg-pink-100 text-pink-600 px-2 py-1 rounded-full font-medium">
            -{{ getDiscountPercentage() }}%
          </span>
        </div>
      } @else {
        <span class="text-xl font-bold text-pink-600">
          ${{ product.price.toLocaleString() }}.00 COP
        </span>
      }
    </div>
    
    <!-- CategorÃ­a y estado con icono de marca -->
    <div class="flex items-center justify-between mt-auto">
      <span class="text-sm text-gray-600">{{ product.category }}</span>
      <div class="flex items-center space-x-2"> 
        <!-- Icono de marca -->
        @if (product.brandCategory === 'diamante') {
          <lucide-angular [img]="Gem" class="w-4 h-4 text-blue-500" />
        } @else if (product.brandCategory === 'oro') {
          <lucide-angular [img]="Crown" class="w-4 h-4 text-yellow-500" />
        } @else if (product.brandCategory === 'esmeralda') {
          <lucide-angular [img]="Shield" class="w-4 h-4 text-green-500" />
        }
      </div>
    </div>
    
  </div>
</div>